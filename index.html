<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HR Employee Attrition Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            background-size: cover;
            background-position: center center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            color: #333;
            min-height: 100vh;
            position: relative;
            transition: background-image 0.5s ease;
        }
        
        body.custom-bg {
            background-color: #1a1a2e;
            color: #ffffff;
        }
        
        body.custom-bg .dynamic-text {
            color: #ffffff !important;
            text-shadow: 0 1px 3px rgba(0,0,0,0.7);
        }
        
        body:not(.custom-bg) .dynamic-text {
            color: #333 !important;
            text-shadow: none;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.2);
            pointer-events: none;
            z-index: 1;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        
        body.custom-bg::before {
            opacity: 0;
        }
        
        .dashboard {
            display: flex;
            height: 100vh;
            position: relative;
            z-index: 2;
            max-width: none;
            margin: 0;
            width: 100%;
            overflow: hidden;
        }
        
        .sidebar {
            background: rgba(74, 111, 165, 0.85);
            width: 180px;
            min-width: 180px;
            max-width: 180px;
            color: white;
            padding: 20px;
            display: flex;
            flex-direction: column;
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            z-index: 1000;
            box-sizing: border-box;
        }
        
        .sidebar.transparent {
            background: rgba(74, 111, 165, 0.6);
        }
        
        .logo {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .logo-icon {
            width: 24px;
            height: 24px;
            background: white;
            margin-right: 10px;
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
        }
        
        .company-name {
            font-size: 18px;
            font-weight: bold;
        }
        
        .tagline {
            font-size: 10px;
            opacity: 0.8;
            margin-top: 2px;
        }
        
        .nav-section {
            margin-bottom: 25px;
        }
        
        .nav-title {
            font-size: 11px;
            font-weight: bold;
            margin-bottom: 10px;
            opacity: 0.8;
        }
        
        .nav-item {
            padding: 8px 0;
            font-size: 13px;
            cursor: pointer;
            opacity: 0.9;
        }
        
        .nav-item.active {
            background: rgba(255,255,255,0.1);
            margin: 0 -20px;
            padding: 8px 20px;
            border-radius: 4px;
        }
        
        .dropdown {
            background: rgba(0,0,0,0.2);
            border: none;
            color: white;
            padding: 5px 8px;
            margin-top: 5px;
            border-radius: 3px;
            font-size: 12px;
            width: 100%;
        }
        
        .main-content {
            flex: 1;
            padding: 12px;
            overflow-y: auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 0 20px 20px 0;
            position: relative;
            z-index: 2;
            transition: all 0.3s ease;
            box-sizing: border-box;
            margin-left: 180px;
            display: flex;
            flex-direction: column;
            height: 100vh;
            justify-content: flex-start;
        }
        
        .main-content.with-settings {
            margin-right: 270px;
        }
        
        .main-content.without-settings {
            margin-right: 0;
        }
        
        .main-content.no-blur {
            backdrop-filter: none;
            background: rgba(255, 255, 255, 0.02);
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            flex-shrink: 0;
        }
        
        .settings-toggle {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 8px;
            cursor: pointer;
            color: #333;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .settings-toggle:hover {
            background: rgba(255, 255, 255, 1);
            transform: rotate(90deg);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .settings-panel {
            position: fixed;
            top: 0;
            right: 0;
            width: 270px;
            height: 100vh;
            background: rgba(74, 111, 165, 0.9);
            backdrop-filter: blur(20px);
            border-left: 1px solid rgba(255, 255, 255, 0.2);
            transition: right 0.3s ease;
            z-index: 1001;
            padding: 20px;
            color: white;
            overflow-y: auto;
            box-sizing: border-box;
        }
        
        .settings-panel.open {
            right: 0;
        }
        
        .settings-panel.closed {
            right: -270px;
        }
        
        .settings-panel.transparent {
            background: rgba(74, 111, 165, 0.7);
        }
        
        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .settings-title {
            font-size: 18px;
            font-weight: bold;
            color: white;
        }
        
        .close-settings {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            padding: 6px;
            cursor: pointer;
            color: white;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
        }
        
        .close-settings:hover {
            background: rgba(255, 100, 100, 0.3);
            border-color: rgba(255, 100, 100, 0.5);
        }
        
        .settings-section {
            margin-bottom: 25px;
        }
        
        .settings-section-title {
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 15px;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
            user-select: none;
        }
        
        .settings-section-title:hover {
            opacity: 1;
        }
        
        .settings-toggle-arrow {
            transition: transform 0.3s ease;
            font-size: 14px;
            display: inline-block;
        }
        
        .settings-content {
            transition: all 0.3s ease;
            overflow: hidden;
        }
        
        .settings-content.hidden {
            max-height: 0;
            opacity: 0;
            margin-bottom: 0;
            padding-top: 0;
            padding-bottom: 0;
        }
        
        .settings-content:not(.hidden) {
            max-height: 500px;
            opacity: 1;
            padding-top: 15px;
        }
        
        .settings-section-title.collapsed .settings-toggle-arrow {
            transform: rotate(-90deg);
        }
        
        .settings-placeholder {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
            margin-bottom: 15px;
        }
        
        .background-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .background-option {
            position: relative;
            height: 50px;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 9px;
            font-weight: bold;
            text-shadow: 0 1px 3px rgba(0,0,0,0.5);
        }
        
        .background-option:hover {
            border-color: rgba(255, 255, 255, 0.5);
            transform: scale(1.02);
        }
        
        .background-option.active {
            border-color: #00d4ff;
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.4);
        }
        
        .bg-default {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
        }
        
        .bg-ocean {
            background: linear-gradient(135deg, #e6f3ff 0%, #cce7ff 50%, #b3daff 100%);
            color: #333;
        }
        
        .bg-forest {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            color: #333;
        }
        
        .bg-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            color: white;
        }
        
        .bg-lemon {
            background: linear-gradient(135deg, #fffffb 0%, #fffef7 50%, #fffacd 100%);
            color: #333;
        }
        
        .bg-mint {
            background: linear-gradient(135deg, #e0fff4 0%, #b3ffda 50%, #7fffd4 100%);
            color: #333;
        }
        
        .bg-lavender {
            background: linear-gradient(135deg, #faf9fd 0%, #f4f1fb 50%, #ede7f6 100%);
            color: #333;
        }
        
        .bg-luxury {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: white;
        }
        
        .bg-gold {
            background: linear-gradient(135deg, #fffef9 0%, #fffacd 30%, #fff8dc 100%);
            color: #333;
        }
        
        .bg-platinum {
            background: linear-gradient(135deg, #f8f8ff 0%, #e6e6fa 50%, #d3d3d3 100%);
            color: #333;
        }
        
        .current-bg-label {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 10px;
            text-align: center;
        }
        
        .file-upload-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .upload-bg-button {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            cursor: pointer;
            color: white;
            font-size: 11px;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 8px;
        }
        
        .upload-bg-button:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
        }
        
        .reset-bg-button {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 8px;
            background: rgba(255, 100, 100, 0.2);
            border: 1px solid rgba(255, 100, 100, 0.3);
            border-radius: 6px;
            cursor: pointer;
            color: white;
            font-size: 11px;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        .reset-bg-button:hover {
            background: rgba(255, 100, 100, 0.3);
            border-color: rgba(255, 100, 100, 0.5);
        }
        
        .title {
            font-size: 18px;
            font-weight: bold;
            color: #4a6fa5;
        }
        
        .filters {
            display: flex;
            gap: 10px;
        }
        
        .filter-btn {
            padding: 8px 16px;
            border: 1px solid rgba(255, 255, 255, 0.5);
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            color: #ffffff;
            font-weight: 500;
            text-shadow: 0 1px 3px rgba(0,0,0,0.5);
            transition: all 0.3s ease;
        }
        
        .filter-btn.active {
            background: rgba(0, 212, 255, 0.3);
            color: #ffffff;
            border-color: #00d4ff;
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.4);
        }
        
        .filter-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.7);
        }
        
        .kpi-row {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
            margin-bottom: 10px;
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
        }
        
        .kpi-card {
            background: rgba(255, 255, 255, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 12px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            overflow: hidden;
        }
        
        .kpi-card.no-blur {
            backdrop-filter: none;
            background: rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 8px 32px rgba(0,0,0,0.1),
                inset 0 1px 0 rgba(255,255,255,0.15),
                inset 0 -1px 0 rgba(0,0,0,0.1);
        }
        
        .kpi-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
        }
        
        .kpi-label {
            font-size: 11px;
            color: #ffffff;
            font-weight: bold;
            margin-bottom: 8px;
            text-shadow: 0 1px 3px rgba(0,0,0,0.5);
        }
        
        .kpi-value {
            font-size: 20px;
            font-weight: bold;
            color: #ffffff;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        
        .kpi-value.highlight {
            color: #00d4ff;
            text-shadow: 0 2px 4px rgba(0,0,0,0.7);
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
            margin-bottom: 10px;
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
            flex: 1;
            align-content: start;
        }
        
        .charts-grid.four-columns {
            grid-template-columns: 1fr 1fr 1fr 1fr;
        }
        
        .chart-container {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 12px;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            position: relative;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            overflow: hidden;
            min-width: 0;
            max-width: 100%;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            height: auto;
            min-height: 250px;
            max-height: 380px;
            justify-content: space-between;
        }
        
        .chart-container.no-blur {
            backdrop-filter: none;
            background: rgba(255, 255, 255, 0.03);
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 8px 32px rgba(0,0,0,0.1),
                inset 0 1px 0 rgba(255,255,255,0.1),
                inset 0 -1px 0 rgba(0,0,0,0.1);
        }
        
        .chart-container:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
        }
        
        .chart-wrapper {
            position: relative;
            width: 100%;
            overflow: hidden;
            flex: 1;
            min-height: 120px;
        }
        
        .chart-wrapper.small {
            min-height: 100px;
        }
        
        .chart-wrapper.tiny {
            min-height: 80px;
        }
        
        .chart-wrapper canvas {
            max-height: 100% !important;
            max-width: 100% !important;
        }
        
        canvas {
            width: 100% !important;
            height: 100% !important;
            max-width: 100% !important;
            max-height: 100% !important;
        }
        
        .image-upload-section {
            border-top: 1px solid rgba(255,255,255,0.2);
            padding-top: 15px;
        }
        
        .upload-button {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 6px;
            cursor: pointer;
            color: white;
            font-size: 10px;
            transition: all 0.3s ease;
            width: 100%;
            justify-content: center;
        }
        
        .upload-button:hover {
            background: rgba(255,255,255,0.2);
            border-color: rgba(255,255,255,0.4);
        }
        
        .reset-button {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 6px 10px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 4px;
            cursor: pointer;
            color: white;
            font-size: 9px;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        .reset-button:hover {
            background: rgba(255,100,100,0.3);
            border-color: rgba(255,100,100,0.5);
        }
        
        .chart-title {
            font-size: 13px;
            font-weight: bold;
            color: #ffffff;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        
        .bottom-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 0;
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
            flex: 1;
            align-content: start;
        }
        
        .horizontal-bar {
            display: flex;
            align-items: center;
            margin-bottom: 6px;
        }
        
        .bar-label {
            width: 80px;
            font-size: 12px;
            color: #666;
        }
        
        .bar-fill {
            flex: 1;
            height: 20px;
            background: rgba(255, 255, 255, 0.08);
            margin: 0 10px;
            position: relative;
            border-radius: 2px;
        }
        
        .bar-value {
            height: 100%;
            background: linear-gradient(90deg, 
                rgba(74, 111, 165, 0.75) 0%, 
                rgba(74, 111, 165, 0.85) 50%, 
                rgba(74, 111, 165, 0.75) 100%);
            border-radius: 2px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 
                inset 0 1px 0 rgba(255,255,255,0.2),
                inset 0 -1px 0 rgba(0,0,0,0.1);
        }
        
        .bar-number {
            font-size: 12px;
            font-weight: bold;
            color: #333;
            min-width: 30px;
        }
        
        .period-selector {
            display: flex;
            gap: 4px;
            margin-bottom: 10px;
        }
        
        .period-btn {
            padding: 4px 8px;
            border: 1px solid rgba(255, 255, 255, 0.4);
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
            color: #ffffff;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
            transition: all 0.3s ease;
        }
        
        .period-btn.active {
            background: rgba(0, 212, 255, 0.3);
            color: #ffffff;
            border-color: #00d4ff;
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.3);
        }
        
        .period-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .distance-cards {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .distance-card {
            flex: 1;
            text-align: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            transition: all 0.3s ease;
        }
        
        .distance-card:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
        }
        
        .distance-label {
            font-size: 11px;
            color: #ffffff;
            margin-bottom: 5px;
            text-shadow: 0 1px 3px rgba(0,0,0,0.5);
        }
        
        .distance-value {
            font-size: 16px;
            font-weight: bold;
            color: #ffffff;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        
        .heatmap {
            display: grid;
            grid-template-columns: 120px repeat(6, 1fr);
            gap: 4px;
            font-size: 11px;
            margin: 15px 0 25px 0;
        }
        
        .heatmap-label {
            padding: 16px 4px;
            background: rgba(255, 255, 255, 0.03);
            display: flex;
            align-items: center;
            font-weight: bold;
            color: #ffffff;
            text-shadow: 0 1px 3px rgba(0,0,0,0.5);
        }
        
        .heatmap-cell {
            padding: 16px 4px;
            text-align: center;
            color: white;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .heat-1 { background: #d6e3f5; color: #333; }
        .heat-2 { background: #9cc3e8; color: #333; }
        .heat-3 { background: #6ba3d6; color: white; }
        .heat-4 { background: #4a6fa5; color: white; }
        .heat-5 { background: #2d4a73; color: white; }
        
        .recovery-panel {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 20px;
            border-radius: 16px;
            color: white;
            position: relative;
        }
        
        .recovery-subtitle {
            font-size: 12px;
            color: #555555;
            margin-bottom: 8px;
            font-style: italic;
        }
        
        .recovery-main-score {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .recovery-label {
            font-size: 12px;
            color: #555555;
        }
        
        .recovery-value {
            font-size: 18px;
            font-weight: bold;
            color: #4a6fa5;
        }
        
        .recovery-chart-container {
            margin-bottom: 15px;
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }
        
        .recovery-chart-title {
            font-size: 12px;
            color: #555555;
            margin-bottom: 10px;
            font-weight: 500;
        }
        
        .radar-chart-wrapper {
            height: 100%;
            min-height: 160px;
            max-height: 220px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            flex: 1;
            overflow: hidden;
        }
        
        .perceived-recovery {
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            padding-top: 20px;
        }
        
        .recovery-metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .recovery-bar-chart {
            height: 80px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .recovery-averages {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .recovery-avg-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .recovery-avg-item .recovery-value {
            font-size: 14px;
            color: #4a6fa5;
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="sidebar">
            <div class="logo">
                <div class="logo-icon"></div>
                <div>
                    <div class="company-name">HR</div>
                    <div class="tagline">Hello!<br>localguest</div>
                </div>
            </div>
            
            <div class="nav-section">
                <div class="nav-title">OVERVIEW</div>
                <div class="nav-item">Gender</div>
                <select class="dropdown">
                    <option>(すべて)</option>
                </select>
                <div class="nav-item" style="margin-top: 15px;">Select</div>
                <select class="dropdown">
                    <option>Attrition</option>
                </select>
            </div>
            
            <div class="nav-section">
                <div class="nav-title">EMPLOYEE DETAILS</div>
            </div>
            
            <div class="image-upload-section" style="margin-bottom: 20px;">
                <div class="upload-button" onclick="document.getElementById('backgroundImage').click()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                    </svg>
                    <span style="margin-left: 5px; font-size: 10px;">背景画像</span>
                </div>
                <input type="file" id="backgroundImage" accept="image/*" style="display: none;" onchange="changeBackground(event)">
                <button class="reset-button" onclick="resetBackground()" style="margin-top: 5px; display: none;" id="resetBtn">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="1 4 1 10 7 10"></polyline>
                        <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
                    </svg>
                    <span style="margin-left: 3px; font-size: 9px;">リセット</span>
                </button>
            </div>
            
            <div style="margin-top: auto; padding-top: 20px;">
                <div style="font-size: 10px; opacity: 0.7;">Designed by<br>taroslava Mizei</div>
                <div style="margin-top: 15px; font-size: 10px; opacity: 0.5;">Data<br>#RWFD</div>
            </div>
        </div>
        
        <div class="main-content with-settings">
            <div class="header">
                <h1 class="title dynamic-text">EMPLOYEE ATTRITION : All Departments</h1>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div class="filters">
                        <button class="filter-btn active">Sales</button>
                        <button class="filter-btn">R&D</button>
                        <button class="filter-btn">HR</button>
                        <button class="filter-btn">All</button>
                    </div>
                    <button class="settings-toggle" onclick="toggleSettingsPanel()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82v0a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                        </svg>
                    </button>
                </div>
            </div>
            
            <div class="kpi-row">
                <div class="kpi-card">
                    <div class="kpi-label dynamic-text">TOTAL EMPLOYEES</div>
                    <div class="kpi-value dynamic-text">1,470</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label dynamic-text">ACTIVE EMPLOYEES</div>
                    <div class="kpi-value dynamic-text">1,233</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label dynamic-text">ATTRITION</div>
                    <div class="kpi-value highlight dynamic-text">237</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label dynamic-text">ATTRITION RATE</div>
                    <div class="kpi-value dynamic-text">16%</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label dynamic-text">AVG. YEARS AT COMPANY</div>
                    <div class="kpi-value dynamic-text">7</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label dynamic-text">AVG. MONTHLY INCOME</div>
                    <div class="kpi-value dynamic-text">6,503 $</div>
                </div>
            </div>
            
            <div class="charts-grid">
                <div class="chart-container">
                    <div class="chart-title dynamic-text">Attrition level tendency || Week</div>
                    <div class="period-selector">
                        <button class="period-btn active">W</button>
                        <button class="period-btn">M</button>
                        <button class="period-btn">Q</button>
                        <button class="period-btn">Y</button>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="weeklyChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title dynamic-text">Attrition || Departments</div>
                    <div style="margin-bottom: 15px;">
                        <div class="horizontal-bar">
                            <div class="bar-label dynamic-text">R&D</div>
                            <div class="bar-fill">
                                <div class="bar-value" style="width: 75%;"></div>
                            </div>
                            <div class="bar-number dynamic-text">133</div>
                        </div>
                        <div class="horizontal-bar">
                            <div class="bar-label dynamic-text">Sales</div>
                            <div class="bar-fill">
                                <div class="bar-value" style="width: 85%;"></div>
                            </div>
                            <div class="bar-number dynamic-text">92</div>
                        </div>
                        <div class="horizontal-bar">
                            <div class="bar-label dynamic-text">HR</div>
                            <div class="bar-fill">
                                <div class="bar-value" style="width: 25%;"></div>
                            </div>
                            <div class="bar-number dynamic-text">12</div>
                        </div>
                    </div>
                    
                    <div class="chart-title dynamic-text" style="margin-top: 15px;">Attrition || Age group</div>
                    <div class="chart-wrapper tiny">
                        <canvas id="ageChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container recovery-panel">
                    <div class="chart-title dynamic-text">Overall Recovery</div>
                    <div class="recovery-subtitle">Aggregate of all metric scores</div>
                    <div class="recovery-main-score">
                        <span class="recovery-label">Most Recent</span>
                        <span class="recovery-value">-9.9%</span>
                    </div>
                    
                    <div class="recovery-chart-container">
                        <div class="recovery-chart-title">Relative Recovery Loss</div>
                        <div class="radar-chart-wrapper">
                            <canvas id="radarChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="charts-grid four-columns">
                <div class="chart-container">
                    <div class="chart-title dynamic-text">Attrition || Gender</div>
                    <div class="horizontal-bar">
                        <div class="bar-label dynamic-text">Female</div>
                        <div class="bar-fill">
                            <div class="bar-value" style="width: 45%;"></div>
                        </div>
                        <div class="bar-number dynamic-text">87</div>
                    </div>
                    <div class="horizontal-bar">
                        <div class="bar-label dynamic-text">Male</div>
                        <div class="bar-fill">
                            <div class="bar-value" style="width: 90%;"></div>
                        </div>
                        <div class="bar-number dynamic-text">150</div>
                    </div>
                    
                    <div class="chart-title dynamic-text" style="margin-top: 15px;">Attrition || Marriage status</div>
                    <div class="horizontal-bar">
                        <div class="bar-label dynamic-text">Divorced</div>
                        <div class="bar-fill">
                            <div class="bar-value" style="width: 35%;"></div>
                        </div>
                        <div class="bar-number dynamic-text">33</div>
                    </div>
                    <div class="horizontal-bar">
                        <div class="bar-label dynamic-text">Married</div>
                        <div class="bar-fill">
                            <div class="bar-value" style="width: 85%;"></div>
                        </div>
                        <div class="bar-number dynamic-text">84</div>
                    </div>
                    <div class="horizontal-bar">
                        <div class="bar-label dynamic-text">Single</div>
                        <div class="bar-fill">
                            <div class="bar-value" style="width: 95%;"></div>
                        </div>
                        <div class="bar-number dynamic-text">120</div>
                    </div>
                </div>
                
                <div class="chart-container" style="min-height: 350px; padding: 12px 12px 30px 12px;">
                    <div class="chart-title dynamic-text" style="margin-bottom: 15px;">Attrition || Job role</div>
                    <div style="display: flex; flex-direction: column; gap: 6px;">
                        <div class="horizontal-bar">
                            <div class="bar-label dynamic-text">Laboratory Technician</div>
                            <div class="bar-fill">
                                <div class="bar-value" style="width: 70%;"></div>
                            </div>
                            <div class="bar-number dynamic-text">62</div>
                        </div>
                        <div class="horizontal-bar">
                            <div class="bar-label dynamic-text">Sales Executive</div>
                            <div class="bar-fill">
                                <div class="bar-value" style="width: 65%;"></div>
                            </div>
                            <div class="bar-number dynamic-text">57</div>
                        </div>
                        <div class="horizontal-bar">
                            <div class="bar-label dynamic-text">Research Scientist</div>
                            <div class="bar-fill">
                                <div class="bar-value" style="width: 55%;"></div>
                            </div>
                            <div class="bar-number dynamic-text">47</div>
                        </div>
                        <div class="horizontal-bar">
                            <div class="bar-label dynamic-text">Sales Representative</div>
                            <div class="bar-fill">
                                <div class="bar-value" style="width: 40%;"></div>
                            </div>
                            <div class="bar-number dynamic-text">33</div>
                        </div>
                        <div class="horizontal-bar">
                            <div class="bar-label dynamic-text">Human Resources</div>
                            <div class="bar-fill">
                                <div class="bar-value" style="width: 15%;"></div>
                            </div>
                            <div class="bar-number dynamic-text">12</div>
                        </div>
                        <div class="horizontal-bar">
                            <div class="bar-label dynamic-text">Manufacturing Director</div>
                            <div class="bar-fill">
                                <div class="bar-value" style="width: 10%;"></div>
                            </div>
                            <div class="bar-number dynamic-text">10</div>
                        </div>
                        <div class="horizontal-bar">
                            <div class="bar-label dynamic-text">Healthcare Representative</div>
                            <div class="bar-fill">
                                <div class="bar-value" style="width: 8%;"></div>
                            </div>
                            <div class="bar-number dynamic-text">9</div>
                        </div>
                        <div class="horizontal-bar">
                            <div class="bar-label dynamic-text">Manager</div>
                            <div class="bar-fill">
                                <div class="bar-value" style="width: 6%;"></div>
                            </div>
                            <div class="bar-number dynamic-text">5</div>
                        </div>
                        <div class="horizontal-bar" style="margin-bottom: 0;">
                            <div class="bar-label dynamic-text">Research Director</div>
                            <div class="bar-fill">
                                <div class="bar-value" style="width: 3%;"></div>
                            </div>
                            <div class="bar-number dynamic-text">2</div>
                        </div>
                    </div>
                </div>
                
                <div class="chart-container recovery-panel">
                    <div class="chart-title dynamic-text">Perceived Recovery</div>
                    <div class="recovery-subtitle">Collected most days</div>
                    
                    <div class="recovery-metric">
                        <span class="recovery-label">Most Recent</span>
                        <span class="recovery-value">-8.2%</span>
                    </div>
                    
                    <div class="recovery-bar-chart">
                        <canvas id="recoveryBarChart"></canvas>
                    </div>
                    
                    <div class="recovery-averages">
                        <div class="recovery-avg-item">
                            <span class="recovery-label">7-Day Avg.</span>
                            <span class="recovery-value">-7.0%</span>
                        </div>
                        <div class="recovery-avg-item">
                            <span class="recovery-label">30-Day Avg.</span>
                            <span class="recovery-value">-11.8%</span>
                        </div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title dynamic-text">Attrition || Department</div>
                    
                    <!-- 上部の円グラフ -->
                    <div style="margin-bottom: 15px;">
                        <div class="chart-wrapper" style="height: 90px;">
                            <canvas id="departmentChart1"></canvas>
                        </div>
                        <div class="department-legend" style="margin-top: 8px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                <div style="display: flex; align-items: center; gap: 6px;">
                                    <div style="width: 8px; height: 8px; background: #4a6fa5; border-radius: 2px;"></div>
                                    <span style="font-size: 9px; color: #333333;">R&D</span>
                                </div>
                                <span style="font-size: 10px; font-weight: bold; color: #333333;">133</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                <div style="display: flex; align-items: center; gap: 6px;">
                                    <div style="width: 8px; height: 8px; background: #6ba3d6; border-radius: 2px;"></div>
                                    <span style="font-size: 9px; color: #333333;">Sales</span>
                                </div>
                                <span style="font-size: 10px; font-weight: bold; color: #333333;">92</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div style="display: flex; align-items: center; gap: 6px;">
                                    <div style="width: 8px; height: 8px; background: #9cc3e8; border-radius: 2px;"></div>
                                    <span style="font-size: 9px; color: #333333;">HR</span>
                                </div>
                                <span style="font-size: 10px; font-weight: bold; color: #333333;">12</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 下部の円グラフ -->
                    <div>
                        <div style="font-size: 11px; color: #333333; margin-bottom: 6px;">By Experience</div>
                        <div class="chart-wrapper" style="height: 90px;">
                            <canvas id="departmentChart2"></canvas>
                        </div>
                        <div class="department-legend" style="margin-top: 8px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                <div style="display: flex; align-items: center; gap: 6px;">
                                    <div style="width: 8px; height: 8px; background: #2d4a73; border-radius: 2px;"></div>
                                    <span style="font-size: 9px; color: #333333;">0-2 years</span>
                                </div>
                                <span style="font-size: 10px; font-weight: bold; color: #333333;">89</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                <div style="display: flex; align-items: center; gap: 6px;">
                                    <div style="width: 8px; height: 8px; background: #4a6fa5; border-radius: 2px;"></div>
                                    <span style="font-size: 9px; color: #333333;">3-5 years</span>
                                </div>
                                <span style="font-size: 10px; font-weight: bold; color: #333333;">95</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div style="display: flex; align-items: center; gap: 6px;">
                                    <div style="width: 8px; height: 8px; background: #6ba3d6; border-radius: 2px;"></div>
                                    <span style="font-size: 9px; color: #333333;">6+ years</span>
                                </div>
                                <span style="font-size: 10px; font-weight: bold; color: #333333;">53</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="bottom-row">
                <div class="chart-container">
                    <div class="chart-title dynamic-text">Attrition || Distance from home</div>
                    <div class="distance-cards">
                        <div class="distance-card">
                            <div class="distance-label">Distance<br>1-9 km</div>
                            <div style="margin: 8px 0; font-size: 10px; color: #4a6fa5; font-weight: bold;">Attrition</div>
                            <div class="distance-value">133</div>
                        </div>
                        <div class="distance-card">
                            <div class="distance-label">Distance<br>10-20 km</div>
                            <div style="margin: 8px 0; font-size: 10px; color: #4a6fa5; font-weight: bold;">Attrition</div>
                            <div class="distance-value">55</div>
                        </div>
                        <div class="distance-card">
                            <div class="distance-label">Distance<br>21-30 km</div>
                            <div style="margin: 8px 0; font-size: 10px; color: #4a6fa5; font-weight: bold;">Attrition</div>
                            <div class="distance-value">49</div>
                        </div>
                    </div>
                    <div class="chart-wrapper small">
                        <canvas id="distanceChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title dynamic-text">Attrition || Education level & Education field</div>
                    <div class="heatmap">
                        <div class="heatmap-label"></div>
                        <div class="heatmap-label dynamic-text">Human Resources</div>
                        <div class="heatmap-label dynamic-text">Life Sciences</div>
                        <div class="heatmap-label dynamic-text">Marketing</div>
                        <div class="heatmap-label dynamic-text">Medical</div>
                        <div class="heatmap-label dynamic-text">Other</div>
                        <div class="heatmap-label dynamic-text">Technical Degree</div>
                        
                        <div class="heatmap-label dynamic-text">Associates Degree</div>
                        <div class="heatmap-cell heat-1">0</div>
                        <div class="heatmap-cell heat-3">18</div>
                        <div class="heatmap-cell heat-2">6</div>
                        <div class="heatmap-cell heat-3">15</div>
                        <div class="heatmap-cell heat-1">1</div>
                        <div class="heatmap-cell heat-2">4</div>
                        
                        <div class="heatmap-label dynamic-text">BA Degree</div>
                        <div class="heatmap-cell heat-2">4</div>
                        <div class="heatmap-cell heat-4">37</div>
                        <div class="heatmap-cell heat-3">15</div>
                        <div class="heatmap-cell heat-4">25</div>
                        <div class="heatmap-cell heat-1">2</div>
                        <div class="heatmap-cell heat-3">16</div>
                        
                        <div class="heatmap-label dynamic-text">DArts</div>
                        <div class="heatmap-cell heat-1">1</div>
                        <div class="heatmap-cell heat-1">1</div>
                        <div class="heatmap-cell heat-1">1</div>
                        <div class="heatmap-cell heat-1">0</div>
                        <div class="heatmap-cell heat-1">0</div>
                        <div class="heatmap-cell heat-1">2</div>
                        
                        <div class="heatmap-label dynamic-text">High School</div>
                        <div class="heatmap-cell heat-1">1</div>
                        <div class="heatmap-cell heat-2">8</div>
                        <div class="heatmap-cell heat-2">4</div>
                        <div class="heatmap-cell heat-3">10</div>
                        <div class="heatmap-cell heat-1">2</div>
                        <div class="heatmap-cell heat-2">6</div>
                        
                        <div class="heatmap-label dynamic-text">MA Degree</div>
                        <div class="heatmap-cell heat-1">1</div>
                        <div class="heatmap-cell heat-4">25</div>
                        <div class="heatmap-cell heat-2">9</div>
                        <div class="heatmap-cell heat-3">13</div>
                        <div class="heatmap-cell heat-2">6</div>
                        <div class="heatmap-cell heat-2">4</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 設定パネル -->
    <div class="settings-panel open" id="settingsPanel">
        <div class="settings-header">
            <div class="settings-title">Settings</div>
            <button class="close-settings" onclick="toggleSettingsPanel()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        
        <div class="settings-section">
            <div class="settings-section-title collapsed" id="displayOptionsToggle" onclick="toggleDisplayOptions()">
                Display Options
                <span class="settings-toggle-arrow">►</span>
            </div>
            <div class="settings-content hidden" id="displayOptionsContent">
                <div class="current-bg-label">Background Theme</div>
                <div class="background-selector">
                    <div class="background-option bg-default active" onclick="setTheme('default')" title="Default Light Blue">
                        Default
                    </div>
                    <div class="background-option bg-ocean" onclick="setTheme('ocean')" title="Ocean Blue">
                        Ocean
                    </div>
                    <div class="background-option bg-forest" onclick="setTheme('forest')" title="Mint Forest">
                        Forest
                    </div>
                    <div class="background-option bg-gradient" onclick="setTheme('gradient')" title="Purple Gradient">
                        Gradient
                    </div>
                    <div class="background-option bg-lemon" onclick="setTheme('lemon')" title="Soft Lemon">
                        Lemon
                    </div>
                    <div class="background-option bg-mint" onclick="setTheme('mint')" title="Fresh Mint">
                        Mint
                    </div>
                    <div class="background-option bg-lavender" onclick="setTheme('lavender')" title="Soft Lavender">
                        Lavender
                    </div>
                    <div class="background-option bg-luxury" onclick="setTheme('luxury')" title="Luxury Dark">
                        Luxury
                    </div>
                    <div class="background-option bg-gold" onclick="setTheme('gold')" title="Elegant Gold">
                        Gold
                    </div>
                    <div class="background-option bg-platinum" onclick="setTheme('platinum')" title="Platinum Silver">
                        Platinum
                    </div>
                </div>
                
                <div class="file-upload-section">
                    <div class="upload-bg-button" onclick="document.getElementById('settingsBgImage').click()">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                        </svg>
                        <span style="margin-left: 8px;">Custom Image</span>
                    </div>
                    <input type="file" id="settingsBgImage" accept="image/*" style="display: none;" onchange="uploadCustomBackground(event)">
                    <button class="reset-bg-button" onclick="resetToDefault()">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="1 4 1 10 7 10"></polyline>
                            <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
                        </svg>
                        <span style="margin-left: 6px;">Reset</span>
                    </button>
                </div>
            </div>
        </div>
        
        <div class="settings-section">
            <div class="settings-section-title">Data Filters</div>
            <div class="settings-placeholder">
                フィルター設定エリア
            </div>
        </div>
        
        <div class="settings-section">
            <div class="settings-section-title">Export Options</div>
            <div class="settings-placeholder">
                エクスポート機能
            </div>
        </div>
        
        <div class="settings-section">
            <div class="settings-section-title">About</div>
            <div class="settings-placeholder">
                ダッシュボード情報
            </div>
        </div>
    </div>

    <script>
        // 背景テーマ定義
        const themes = {
            default: 'linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%)',
            ocean: 'linear-gradient(135deg, #e6f3ff 0%, #cce7ff 50%, #b3daff 100%)',
            forest: 'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)',
            gradient: 'linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%)',
            lemon: 'linear-gradient(135deg, #fffffb 0%, #fffef7 50%, #fffacd 100%)',
            mint: 'linear-gradient(135deg, #e0fff4 0%, #b3ffda 50%, #7fffd4 100%)',
            lavender: 'linear-gradient(135deg, #faf9fd 0%, #f4f1fb 50%, #ede7f6 100%)',
            luxury: 'linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)',
            gold: 'linear-gradient(135deg, #fffef9 0%, #fffacd 30%, #fff8dc 100%)',
            platinum: 'linear-gradient(135deg, #f8f8ff 0%, #e6e6fa 50%, #d3d3d3 100%)'
        };
        
        let settingsOpen = true;
        
        // 設定パネルの開閉
        function toggleSettingsPanel() {
            const panel = document.getElementById('settingsPanel');
            const mainContent = document.querySelector('.main-content');
            
            if (settingsOpen) {
                panel.classList.remove('open');
                panel.classList.add('closed');
                mainContent.classList.remove('with-settings');
                mainContent.classList.add('without-settings');
                settingsOpen = false;
            } else {
                panel.classList.remove('closed');
                panel.classList.add('open');
                mainContent.classList.remove('without-settings');
                mainContent.classList.add('with-settings');
                settingsOpen = true;
            }
            
            setTimeout(() => {
                window.dispatchEvent(new Event('resize'));
            }, 350);
        }
        
        // Display Options の開閉
        function toggleDisplayOptions() {
            const content = document.getElementById('displayOptionsContent');
            const toggle = document.getElementById('displayOptionsToggle');
            const arrow = toggle.querySelector('.settings-toggle-arrow');
            
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                toggle.classList.remove('collapsed');
                arrow.textContent = '▼';
            } else {
                content.classList.add('hidden');
                toggle.classList.add('collapsed');
                arrow.textContent = '►';
            }
        }
        
        // テーマ設定
        function setTheme(themeName) {
            if (themes[themeName]) {
                document.body.style.background = themes[themeName];
                document.body.style.backgroundSize = 'cover';
                document.body.style.backgroundPosition = 'center center';
                document.body.style.backgroundAttachment = 'fixed';
                document.body.classList.remove('custom-bg');
                
                // アクティブ状態更新
                document.querySelectorAll('.background-option').forEach(opt => {
                    opt.classList.remove('active');
                });
                document.querySelector('.bg-' + themeName).classList.add('active');
                
                // エフェクトリセット
                resetEffects();
            }
        }
        
        // カスタム背景アップロード
        function uploadCustomBackground(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.body.style.background = '';
                    document.body.style.backgroundImage = 'url(' + e.target.result + ')';
                    document.body.style.backgroundSize = 'cover';
                    document.body.style.backgroundPosition = 'center center';
                    document.body.style.backgroundAttachment = 'fixed';
                    document.body.classList.add('custom-bg');
                    
                    // アクティブ状態クリア
                    document.querySelectorAll('.background-option').forEach(opt => {
                        opt.classList.remove('active');
                    });
                    
                    applyCustomEffects();
                };
                reader.readAsDataURL(file);
            }
        }
        
        // デフォルトリセット
        function resetToDefault() {
            setTheme('default');
            const bgInput = document.getElementById('settingsBgImage');
            if (bgInput) bgInput.value = '';
        }
        
        // エフェクトリセット
        function resetEffects() {
            const elements = [
                '.main-content', '.sidebar', '.settings-panel',
                '.kpi-card', '.chart-container'
            ];
            
            elements.forEach(selector => {
                document.querySelectorAll(selector).forEach(el => {
                    el.classList.remove('no-blur', 'transparent');
                });
            });
            
            const resetBtn = document.getElementById('resetBtn');
            if (resetBtn) resetBtn.style.display = 'none';
        }
        
        // カスタム背景エフェクト適用
        function applyCustomEffects() {
            const elements = [
                '.main-content', '.sidebar', '.settings-panel',
                '.kpi-card', '.chart-container'
            ];
            
            elements.forEach(selector => {
                document.querySelectorAll(selector).forEach(el => {
                    if (selector === '.sidebar' || selector === '.settings-panel') {
                        el.classList.add('transparent');
                    } else {
                        el.classList.add('no-blur');
                    }
                });
            });
        }
        
        // チャート初期化
        function initCharts() {
            console.log('Initializing charts...');
            
            // Chart.jsの読み込み確認
            if (typeof Chart === 'undefined') {
                console.error('Chart.js is not loaded');
                return;
            }
            
            console.log('Chart.js is available, creating charts...');
            
            try {
                // Weekly Chart
                const weeklyCtx = document.getElementById('weeklyChart');
                if (weeklyCtx && weeklyCtx.getContext) {
                    console.log('Creating weekly chart...');
                    new Chart(weeklyCtx.getContext('2d'), {
                        type: 'bar',
                        data: {
                            labels: ['2021 W47', '2021 W49', '2021 W51', '2022 W1', '2022 W3', '2022 W5', '2022 W7', '2022 W9', '2022 W11', '2022 W13', '2022 W15'],
                            datasets: [{
                                data: [3, 5, 4, 7, 8, 12, 15, 18, 22, 25, 28],
                                backgroundColor: '#4a6fa5',
                                borderRadius: 2,
                                maxBarThickness: 20
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: { 
                                    beginAtZero: true, 
                                    max: 30, 
                                    grid: { color: 'rgba(255,255,255,0.3)' }, 
                                    ticks: { font: { size: 10 }, color: '#ffffff' } 
                                },
                                x: { 
                                    grid: { display: false }, 
                                    ticks: { font: { size: 9 }, maxRotation: 45, color: '#ffffff' } 
                                }
                            },
                            plugins: { legend: { display: false } }
                        }
                    });
                }
                
                // Age Chart
                const ageCtx = document.getElementById('ageChart');
                if (ageCtx && ageCtx.getContext) {
                    console.log('Creating age chart...');
                    new Chart(ageCtx.getContext('2d'), {
                        type: 'bar',
                        data: {
                            labels: ['<=19', '20-29', '30-39', '40-49', '50-59', '>=60'],
                            datasets: [{
                                data: [8, 112, 51, 25, 18, 23],
                                backgroundColor: '#4a6fa5',
                                borderRadius: 2,
                                maxBarThickness: 30
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: { 
                                    beginAtZero: true, 
                                    max: 120, 
                                    grid: { color: 'rgba(255,255,255,0.3)' }, 
                                    ticks: { font: { size: 10 }, color: '#ffffff' } 
                                },
                                x: { 
                                    grid: { display: false }, 
                                    ticks: { font: { size: 10 }, color: '#ffffff' } 
                                }
                            },
                            plugins: { legend: { display: false } }
                        }
                    });
                }
                
                // Distance Chart
                const distanceCtx = document.getElementById('distanceChart');
                if (distanceCtx && distanceCtx.getContext) {
                    console.log('Creating distance chart...');
                    new Chart(distanceCtx.getContext('2d'), {
                        type: 'scatter',
                        data: {
                            datasets: [{
                                data: [
                                    {x: 2, y: 10}, {x: 5, y: 15}, {x: 8, y: 12}, {x: 12, y: 8}, 
                                    {x: 15, y: 6}, {x: 18, y: 4}, {x: 22, y: 7}, {x: 25, y: 5}, {x: 28, y: 3}
                                ],
                                backgroundColor: '#4a6fa5',
                                borderColor: '#4a6fa5',
                                pointRadius: 6,
                                pointHoverRadius: 8
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: { 
                                    beginAtZero: true, 
                                    max: 20, 
                                    grid: { color: 'rgba(255,255,255,0.3)' }, 
                                    ticks: { font: { size: 10 }, color: '#ffffff' } 
                                },
                                x: { 
                                    beginAtZero: true, 
                                    max: 30, 
                                    title: { display: true, text: 'Distance (km)', font: { size: 10 }, color: '#ffffff' }, 
                                    grid: { color: 'rgba(255,255,255,0.3)' }, 
                                    ticks: { font: { size: 10 }, color: '#ffffff' } 
                                }
                            },
                            plugins: { legend: { display: false } }
                        }
                    });
                }
                
                // Radar Chart for Recovery
                const radarCtx = document.getElementById('radarChart');
                if (radarCtx && radarCtx.getContext) {
                    console.log('Creating radar chart...');
                    
                    const radarChart = new Chart(radarCtx.getContext('2d'), {
                        type: 'radar',
                        data: {
                            labels: ['Soreness', 'Inflammation', 'Joint Range', 'Load Tolerance', 'Perceived Recovery', 'Sleep'],
                            datasets: [{
                                data: [65, 45, 70, 55, 60, 50],
                                backgroundColor: 'rgba(74, 111, 165, 0.3)',
                                borderColor: '#666666',
                                borderWidth: 3,
                                pointBackgroundColor: '#666666',
                                pointBorderColor: '#ffffff',
                                pointBorderWidth: 2,
                                pointRadius: 4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            layout: {
                                padding: 5
                            },
                            scales: {
                                r: {
                                    beginAtZero: true,
                                    min: 0,
                                    max: 100,
                                    grid: { 
                                        color: '#666666',
                                        lineWidth: 1
                                    },
                                    angleLines: { 
                                        color: '#666666',
                                        lineWidth: 1
                                    },
                                    pointLabels: { 
                                        color: '#444444', 
                                        font: { size: 11, weight: 'bold' },
                                        padding: 8
                                    },
                                    ticks: { 
                                        display: false,
                                        stepSize: 20
                                    }
                                }
                            },
                            plugins: { 
                                legend: { display: false },
                                tooltip: { enabled: true }
                            },
                            elements: {
                                point: {
                                    radius: 4,
                                    hoverRadius: 6
                                },
                                line: {
                                    borderWidth: 3
                                }
                            }
                        }
                    });
                    
                    console.log('Radar chart created successfully:', radarChart);
                } else {
                    console.error('Radar chart canvas not found or invalid');
                }
                
                // Recovery Bar Chart
                const recoveryBarCtx = document.getElementById('recoveryBarChart');
                if (recoveryBarCtx && recoveryBarCtx.getContext) {
                    console.log('Creating recovery bar chart...');
                    new Chart(recoveryBarCtx.getContext('2d'), {
                        type: 'bar',
                        data: {
                            labels: ['', '', '', '', '', '', ''],
                            datasets: [{
                                data: [-5, -3, -8, -2, -6, -4, -8],
                                backgroundColor: ['#666', '#666', '#666', '#666', '#666', '#666', '#4a6fa5'],
                                borderRadius: 4,
                                maxBarThickness: 18
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            indexAxis: 'y',
                            layout: {
                                padding: {
                                    top: 0,
                                    bottom: 0,
                                    left: 0,
                                    right: 0
                                }
                            },
                            scales: {
                                x: { 
                                    display: false,
                                    grid: { display: false }
                                },
                                y: { 
                                    display: false,
                                    grid: { display: false }
                                }
                            },
                            plugins: { 
                                legend: { display: false },
                                tooltip: { enabled: false }
                            },
                            elements: {
                                bar: {
                                    borderWidth: 0
                                }
                            }
                        }
                    });
                }
                
                // Department Pie Chart 1 (上部)
                const departmentCtx1 = document.getElementById('departmentChart1');
                if (departmentCtx1 && departmentCtx1.getContext) {
                    console.log('Creating department chart 1...');
                    // キャンバスのサイズを明示的に設定
                    departmentCtx1.width = 200;
                    departmentCtx1.height = 120;
                    
                    new Chart(departmentCtx1.getContext('2d'), {
                        type: 'doughnut',
                        data: {
                            labels: ['R&D', 'Sales', 'HR'],
                            datasets: [{
                                data: [133, 92, 12],
                                backgroundColor: ['#4a6fa5', '#6ba3d6', '#9cc3e8'],
                                borderColor: ['#ffffff', '#ffffff', '#ffffff'],
                                borderWidth: 1,
                                cutout: '50%'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            animation: {
                                duration: 1000
                            },
                            plugins: {
                                legend: {
                                    display: false
                                },
                                tooltip: {
                                    enabled: true,
                                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                    titleColor: '#ffffff',
                                    bodyColor: '#ffffff',
                                    borderColor: '#4a6fa5',
                                    borderWidth: 1,
                                    callbacks: {
                                        label: function(context) {
                                            const label = context.label || '';
                                            const value = context.parsed;
                                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                            const percentage = Math.round((value / total) * 100);
                                            return `${label}: ${value} (${percentage}%)`;
                                        }
                                    }
                                }
                            }
                        }
                    });
                    console.log('Department chart 1 created successfully');
                } else {
                    console.error('Department chart 1 canvas not found');
                }
                
                // Department Pie Chart 2 (下部) - Experience
                const departmentCtx2 = document.getElementById('departmentChart2');
                if (departmentCtx2 && departmentCtx2.getContext) {
                    console.log('Creating department chart 2...');
                    // キャンバスのサイズを明示的に設定
                    departmentCtx2.width = 200;
                    departmentCtx2.height = 120;
                    
                    new Chart(departmentCtx2.getContext('2d'), {
                        type: 'doughnut',
                        data: {
                            labels: ['0-2 years', '3-5 years', '6+ years'],
                            datasets: [{
                                data: [89, 95, 53],
                                backgroundColor: ['#2d4a73', '#4a6fa5', '#6ba3d6'],
                                borderColor: ['#ffffff', '#ffffff', '#ffffff'],
                                borderWidth: 1,
                                cutout: '50%'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            animation: {
                                duration: 1000
                            },
                            plugins: {
                                legend: {
                                    display: false
                                },
                                tooltip: {
                                    enabled: true,
                                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                    titleColor: '#ffffff',
                                    bodyColor: '#ffffff',
                                    borderColor: '#4a6fa5',
                                    borderWidth: 1,
                                    callbacks: {
                                        label: function(context) {
                                            const label = context.label || '';
                                            const value = context.parsed;
                                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                            const percentage = Math.round((value / total) * 100);
                                            return `${label}: ${value} (${percentage}%)`;
                                        }
                                    }
                                }
                            }
                        }
                    });
                    console.log('Department chart 2 created successfully');
                } else {
                    console.error('Department chart 2 canvas not found');
                }
                
                console.log('All charts created successfully');
                
            } catch (error) {
                console.error('Chart initialization error:', error);
            }
        }
        
        // インタラクティブボタン初期化
        function initInteractions() {
            try {
                // Filter buttons
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                        this.classList.add('active');
                    });
                });
                
                // Period buttons
                document.querySelectorAll('.period-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
                        this.classList.add('active');
                    });
                });
            } catch (error) {
                console.warn('Interaction initialization error:', error);
            }
        }
        
        // サイドバー背景機能
        function changeBackground(event) {
            try {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        document.body.style.backgroundImage = 'url(' + e.target.result + ')';
                        document.body.style.backgroundSize = 'cover';
                        document.body.classList.add('custom-bg');
                        
                        applyCustomEffects();
                        
                        const resetBtn = document.getElementById('resetBtn');
                        if (resetBtn) resetBtn.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                }
            } catch (error) {
                console.warn('Background change error:', error);
            }
        }
        
        function resetBackground() {
            try {
                setTheme('default');
                const resetBtn = document.getElementById('resetBtn');
                const bgInput = document.getElementById('backgroundImage');
                if (resetBtn) resetBtn.style.display = 'none';
                if (bgInput) bgInput.value = '';
            } catch (error) {
                console.warn('Background reset error:', error);
            }
        }
        
        // 遅延初期化システム
        function initChartsWithDelay() {
            let attempts = 0;
            const maxAttempts = 15;
            
            function tryInit() {
                attempts++;
                console.log(`Chart initialization attempt ${attempts}/${maxAttempts}`);
                
                if (typeof Chart !== 'undefined') {
                    console.log('Chart.js found, initializing charts...');
                    // 少し遅延を追加してDOM要素が確実に準備されるのを待つ
                    setTimeout(() => {
                        initCharts();
                    }, 500);
                    return;
                }
                
                if (attempts < maxAttempts) {
                    console.log('Chart.js not ready, retrying in 300ms...');
                    setTimeout(tryInit, 300);
                } else {
                    console.error('Chart.js failed to load after maximum attempts');
                }
            }
            
            tryInit();
        }
        
        // 初期化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing dashboard...');
            
            // デフォルトテーマ設定
            setTheme('default');
            
            // レイアウト初期化
            const mainContent = document.querySelector('.main-content');
            const settingsPanel = document.getElementById('settingsPanel');
            
            if (mainContent && settingsPanel) {
                mainContent.classList.add('with-settings');
                settingsPanel.classList.add('open');
            }
            
            // インタラクション初期化
            initInteractions();
            
            // チャート初期化（遅延）
            setTimeout(() => {
                initChartsWithDelay();
            }, 100);
        });
        
        // ページが既に読み込み済みの場合
        if (document.readyState !== 'loading') {
            console.log('Document already loaded, initializing...');
            setTheme('default');
            setTimeout(() => {
                initChartsWithDelay();
                initInteractions();
            }, 100);
        }
        
        // ウィンドウ読み込み完了時
        window.addEventListener('load', function() {
            console.log('Window fully loaded');
            setTimeout(() => {
                if (typeof Chart !== 'undefined') {
                    console.log('Chart.js confirmed available on window load');
                    // チャートリサイズ
                    window.dispatchEvent(new Event('resize'));
                }
            }, 100);
        });
    </script>
</body>
</html>
